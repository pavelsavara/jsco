//! Pavel Savara licenses this file to you under the MIT license.
var e="Release";function n(e,n){if(e)return;const t="Assert failed: "+("function"==typeof n?n():n);throw new Error(t)}let t="Debug",r=!1;function o(e,n,t){if(!r)return;const o=e.debugStack??[];n.debugStack=[t,...o]}const s="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;async function a(e){if("length"in e||"getReader"in e)return e;if("body"in e)return a(e.body);if("then"in e)return a(await e);throw new Error("I got "+typeof e)}class c{total;bpos;buf;reader;constructor(e){this.total=0,this.bpos=0,this.buf=null,this.reader=e.getReader()}get pos(){return this.total}async fill(e){if(null===this.buf||this.buf.length-this.bpos<1){const e=await this.reader.read();if(e.done)return"EOF";this.buf=e.value,this.bpos=0}const n=this.bpos,t=Math.min(this.buf.length-n,e);return this.bpos+=t,this.total+=t,this.buf.subarray(n,n+t)}async readAvailable(e){if(null===this.buf||this.buf.length-this.bpos<1){const e=await this.reader.read();if(e.done)return null;this.buf=e.value,this.bpos=0}const n=this.bpos,t=Math.min(this.buf.length-n,e);return this.bpos+=t,this.total+=t,this.buf.subarray(n,n+t)}async read(e){const n=await this.fill(1);if("EOF"===n){if(!0===e)return null;throw new Error("unexpected EOF.")}return n[0]}async readExact(e){const n=new Uint8Array(e);let t=e;for(;t>0;){const e=await this.fill(t);if("EOF"===e)throw new Error("unexpected EOF.");n.set(e,n.length-t),t-=e.length}return n}async skip(e){if(e<0)throw new Error("illegal argument.");let n=e;for(;n>0;){const e=await this.fill(n);if("EOF"===e)throw new Error("unexpected EOF.");n-=e.length}}subSource(e){return new u(this,e)}async subSyncSource(e){const n=await this.readExact(e);return new l(n)}close(){this.reader.releaseLock()}}class i{_pos;items;constructor(e){this._pos=0,this.items=Uint8Array.from(e)}get pos(){return this._pos}readAvailable(e){if(0===this.items.byteLength||this._pos==this.items.byteLength||0===e)return Promise.resolve(null);const n=Math.min(this.items.byteLength-this._pos,e),t=this.items.subarray(this._pos,this._pos+n);return this._pos+=t.byteLength,Promise.resolve(t)}read(e){try{if(this.items.length-this._pos<1){if(e)return Promise.resolve(null);throw new Error("unexpected EOF.")}const n=this.items[this._pos];return this._pos+=1,Promise.resolve(n)}catch(e){return Promise.reject(e)}}readExact(e){try{if(0===e)return Promise.resolve(Uint8Array.from([]));if(e<1)throw new Error("illegal argument.");if(this.items.length-this._pos<e)throw new Error("unexpected EOF.");const n=this.items.subarray(this._pos,this._pos+e);return this._pos+=e,Promise.resolve(n)}catch(e){return Promise.reject(e)}}skip(e){try{if(0===e)return Promise.resolve();if(e<1)throw new Error("illegal argument.");if(this.items.length-this._pos<e)throw new Error("unexpected EOF.");return this._pos+=e,Promise.resolve()}catch(e){return Promise.reject(e)}}subSource(e){return new u(this,e)}async subSyncSource(e){const n=await this.readExact(e);return new l(n)}close(){}}class u{delegate;rest;constructor(e,n){if(n<0)throw new Error("illegal argument.");this.delegate=e,this.rest=n}get pos(){return this.delegate.pos}async readAvailable(e){const n=Math.min(e,this.rest),t=await this.delegate.readAvailable(n);return t&&(this.rest-=t.byteLength),t}async read(e){let n;return this.checkLimit(1),n=!0===e?await this.delegate.read(!0):await this.delegate.read(),n&&(this.rest-=1),n}async readExact(e){this.checkLimit(e);const n=await this.delegate.readExact(e);return this.rest-=n.length,n}async skip(e){this.checkLimit(e),await this.delegate.skip(e),this.rest-=e}subSource(e){return new u(this,e)}async subSyncSource(e){const n=await this.readExact(e);return new l(n)}checkLimit(e){if(this.rest<e)throw new Error("limit reached.")}}class l{_pos;items;constructor(e){this._pos=0,this.items=Uint8Array.from(e)}get pos(){return this._pos}get remaining(){return this.items.length-this._pos}read(e){if(this.items.length-this._pos<1&&!e)throw new Error("unexpected EOF.");const n=this.items[this._pos];return this._pos+=1,n}readExact(e){if(0===e)return Uint8Array.from([]);if(e<1)throw new Error("illegal argument.");if(this.items.length-this._pos<e)throw new Error("unexpected EOF.");const n=this.items.subarray(this._pos,this._pos+e);return this._pos+=e,n}skip(e){if(0!==e){if(e<1)throw new Error("illegal argument.");if(this.items.length-this._pos<e)throw new Error("unexpected EOF.");this._pos+=e}}}const m=((e,n=(e=>void 0!==e?": "+e:""))=>class extends Error{constructor(t){super(e(t)+n(t))}})((()=>"unsupported operation")),p=Symbol(),d=()=>{},f=e=>((e,n)=>null!=e&&"function"==typeof e[n])(e,"xform")?e.xform():e;class g{constructor(e){this.value=e}deref(){return this.value}}const h=e=>e instanceof g,w=e=>e instanceof g?e.deref():e;function*y(e,n){const t=f(e)([d,d,(e,n)=>n])[2];for(let e of n){let n=t(p,e);if(h(n))return n=w(n.deref()),void(n!==p&&(yield n));n!==p&&(yield n)}}let A,E;if("undefined"!=typeof window&&void 0!==window.WebAssembly||"undefined"!=typeof global&&void 0!==global.WebAssembly){const e=new WebAssembly.Instance(new WebAssembly.Module(function e(n){return n?new Uint8Array([...y(e(),n)]):e=>{const n=e[2];let t=0,r=0;return((e,n)=>[e[0],e[1],n])(e,((e,o)=>{switch(o){case"-":o="+";break;case"_":o="/";break;case"=":return(e=>new g(e))(e)}const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(o);return r=3&t?(r<<6)+s:s,3&t++&&(e=n(e,255&r>>(-2*t&6))),e}))}}("AGFzbQEAAAABCgJgAX4Bf2AAAX4DBQQAAQABBQMBABEGCQF/AEGAgMAACwdYBgZtZW1vcnkCAA9sZWIxMjhFbmNvZGVVNjQAAANidWYDAA9sZWIxMjhEZWNvZGVVNjQAAQ9sZWIxMjhFbmNvZGVJNjQAAg9sZWIxMjhEZWNvZGVJNjQAAwrBAwRbAQJ/AkAgAEKAAVoEQANAIAFBgIBAayAAp0H/AHEgAEL/AFZBB3RyOgAAIAFBAWohASAAQoABVCAAQgeIIQBFDQALDAELQYCAwAAgADwAAEEBIQELIAFB/wFxC1ECA38CfgNAAkAgAEEBaiECIABBgIBAaywAACIBQf8Aca0gA4YgBIQhBCABQQBODQAgA0IHfCEDIABBCUkgAiEADQELC0GAgMAAIAI6AAAgBAuRAQEDfwJAIABCQH1CgAFaBEBBASECA0AgAkEBcUUNAiABQYCAQGtBAEGAfyAApyICQcAAcSIDRSAAQoABVHEgA0EGdiAAQgeHIgBCf1FxciIDGyACQf8AcXI6AAAgA0UhAiABQQFqIQEMAAsAC0GAgMAAIABCOYinQcAAcSAAp0E/cXI6AABBASEBCyABQf8BcQt+AgN/A35BfyEAA0ACQCAAQQFqIQEgA0IHfCEFIABBgYDAAGotAAAiAEH/AHGtIAOGIASEIQQgAMAiAkEATg0AIAEhACAFIQMgAUEJSQ0BCwtBgIDAACABQQFqOgAAIARCfyAFhkIAIAJBwABxQQZ2G0IAIAFB/wFxQQlJG4QL")));A=e.exports,E=new Uint8Array(A.memory.buffer,A.buf,16)}const x=()=>!A&&(e=>{throw new m(e)})("WASM module unavailable"),b=(C="leb128DecodeU64",I=!1,(e,n=0)=>{x(),E.set(e.subarray(n,Math.min(n+10,e.length)),0);const t=A[C](0,0);return[I?BigInt.asIntN(64,t):BigInt.asUintN(64,t),E[0]]});var C,I;const T=new TextDecoder;async function v(e){return await async function(e,n,t,r){const o=await async function(e){const n=[];for(let t=0;t<X;t++){const t=await e.read();if(n.push(t),0==(128&t))break}return Uint8Array.from(n)}(e),[s,a]=r(o);if(a!==o.length)throw new Error(`invalid data. ${a} !== ${o.length}`);if(s<n||s>t)throw new Error(`overflow. ${K}, ${s}`);return Number(s)}(e,0,4294967295,b)}function F(e){return function(e,n,t,r){const o=function(e){const n=[];for(let t=0;t<X;t++){const t=e.read();if(n.push(t),0==(128&t))break}return Uint8Array.from(n)}(e),[s,a]=r(o);if(a!==o.length)throw new Error(`invalid data. ${a} !== ${o.length}`);if(s<n||s>t)throw new Error(`overflow. ${K}, ${s}`);return Number(s)}(e,0,4294967295,b)}function k(e){const n=F(e),t=[];for(let r=0;r<n;r++)t.push(S(e));return t}function S(e){const n=F(e),t=e.readExact(n);return T.decode(t)}function B(e){switch(e){case 0:return"func";case 1:return"table";case 2:return"memory";case 3:return"global";case 4:return"tag";default:throw new Error(`unknown external kind. ${e}`)}}function D(e){const n=F(e);return 0==n?$(n,F(e)):$(n)}function $(e,n){switch(e){case 0:if(17===n)return"module";throw new Error(`unknown component external kind 2. ${n}`);case 1:return"func";case 2:return"value";case 3:return"type";case 4:return"component";case 5:return"instance";default:throw new Error(`unknown component external kind. 0x${e.toString(16)}`)}}function R(e){const n=F(e),t=[];for(let r=0;r<n;r++){let n;switch(e.read()){case 0:n={tag:"InstanceTypeDeclarationCoreType",value:void 0};break;case 1:n={tag:"InstanceTypeDeclarationType",value:j(e)};break;case 2:n={tag:"InstanceTypeDeclarationAlias",value:void 0};break;case 4:n={tag:"InstanceTypeDeclarationExport",name:Q(e),ty:P(e)}}t.push(n)}return t}function Q(e){const n=F(e);switch(n){case 0:return{tag:"ComponentExternNameKebab",name:S(e)};case 1:return{tag:"ComponentExternNameInterface",name:S(e)};default:throw new Error(`unknown ComponentExternName. ${n}`)}}function _(e){switch(e.read()){case 0:return;case 1:return F(e);default:throw new Error("Invalid leading byte in resource destructor")}}function M(e){const n=F(e),t=[];for(let r=0;r<n;r++)t.push({name:S(e),kind:D(e),index:F(e)});return t}function N(e){const n=e.read();switch(n){case 0:return{tag:"CoreInstanceInstantiate",module_index:F(e),args:U(e)};case 1:return{tag:"CoreInstanceFromExports",exports:O(e)};default:throw new Error(`Unrecognized type in readCoreInstance: ${n}`)}}function O(e){const n=F(e),t=[];for(let r=0;r<n;r++){const n=S(e),r=F(e),o=F(e);t.push({name:n,kind:B(r),index:o})}return t}function U(e){const n=F(e),t=[];for(let r=0;r<n;r++){const n=S(e),r=W(e),o=F(e);t.push({name:n,kind:r,index:o})}return t}function W(e){const n=e.read();if(18!=n)throw new Error(`Unrecognized kind in readInstantiationArgKind: ${n}`);return"instance"}function L(e){const n=e.read();switch(n){case 0:{const n=e.read();if(0!=n)throw new Error(`Unrecognized byte for CanonicalFunctionLift in readCanonicalFunction: ${n}`);return{tag:"CanonicalFunctionLift",core_func_index:F(e),options:V(e),type_index:F(e)}}case 1:{const n=e.read();if(0!=n)throw new Error(`Unrecognized byte for CanonicalFunctionLower in readCanonicalFunction: ${n}`);return{tag:"CanonicalFunctionLower",func_index:F(e),options:V(e)}}case 2:return{tag:"CanonicalFunctionResourceNew",resource:F(e)};case 3:return{tag:"CanonicalFunctionResourceDrop",resource:F(e)};case 4:return{tag:"CanonicalFunctionResourceRep",resource:F(e)};default:throw new Error(`Unrecognized type in readCanonicalFunction: ${n}`)}}function V(e){const n=F(e),t=[];for(let r=0;r<n;r++)t.push(G(e));return t}function G(e){const n=e.read();switch(n){case 0:return{tag:"CanonicalOptionUTF8"};case 1:return{tag:"CanonicalOptionUTF16"};case 2:return{tag:"CanonicalOptionCompactUTF16"};case 3:return{tag:"CanonicalOptionMemory",value:F(e)};case 4:return{tag:"CanonicalOptionRealloc",value:F(e)};case 5:return{tag:"CanonicalOptionPostReturn",value:F(e)};default:throw new Error(`Unrecognized type in readCanonicalOption = ${n}.`)}}function j(e){const n=e.read();switch(n){case 63:return{tag:"ComponentTypeResource",rep:F(e),dtor:_(e)};case 64:return{tag:"ComponentTypeFunc",params:z(e),results:Z(e)};case 65:return{tag:"ComponentTypeComponent",declarations:void 0};case 66:return{tag:"ComponentTypeInstance",declarations:R(e)};default:return function(e,n){switch(n){case 104:return{tag:"ComponentTypeDefinedBorrow",value:F(e)};case 105:return{tag:"ComponentTypeDefinedOwn",value:F(e)};case 106:return{tag:"ComponentTypeDefinedResult",ok:H(e),err:H(e)};case 107:return{tag:"ComponentTypeDefinedOption",value:H(e)};case 109:return{tag:"ComponentTypeDefinedEnum",members:k(e)};case 110:return{tag:"ComponentTypeDefinedFlags",members:k(e)};case 111:{const n=F(e),t=[];for(let r=0;r<n;r++)t.push(H(e));return{tag:"ComponentTypeDefinedTuple",members:t}}case 112:return{tag:"ComponentTypeDefinedList",value:H(e)};case 113:{const n=F(e),t=[];for(let r=0;r<n;r++)t.push({name:S(e),ty:H(e),refines:F(e)});return{tag:"ComponentTypeDefinedVariant",variants:t}}case 114:{const n=F(e),t=[];for(let r=0;r<n;r++)t.push({name:S(e),type:H(e)});return{tag:"ComponentTypeDefinedRecord",members:t}}default:throw new Error(`Unrecognized type in readComponentTypeDefined: ${n}`)}}(e,n)}}function P(e){const n=F(e);switch(n){case 0:return{tag:"ComponentTypeRefModule",value:F(e)};case 1:return{tag:"ComponentTypeRefFunc",value:F(e)};case 2:return{tag:"ComponentTypeRefValue",value:H(e)};case 3:return{tag:"ComponentTypeRefType",value:J(e)};case 4:return{tag:"ComponentTypeRefInstance",value:F(e)};case 5:return{tag:"ComponentTypeRefComponent",value:F(e)};default:throw new Error(`unknown ComponentExternName. ${n}`)}}function z(e){const n=[],t=F(e);for(let r=0;r<t;r++)n.push({name:S(e),type:H(e)});return n}function Z(e){const n=e.read();switch(n){case 0:return{tag:"ComponentFuncResultUnnamed",type:H(e)};case 1:return{tag:"ComponentFuncResultNamed",values:z(e)};default:throw new Error(`unknown ComponentFuncResult type: ${n}`)}}function H(e){const n=F(e);return 115<=n&&n<=127?{tag:"ComponentValTypePrimitive",value:Y(n)}:{tag:"ComponentValTypeType",value:n}}function J(e){const n=F(e);switch(n){case 0:return{tag:"TypeBoundsEq",value:F(e)};case 1:return{tag:"TypeBoundsSubResource"};default:throw new Error(`unknown type bounds. ${n}`)}}function Y(e){switch(e){case 127:return"bool";case 126:return"s8";case 125:return"u8";case 124:return"s16";case 123:return"u16";case 122:return"s32";case 121:return"u32";case 120:return"s64";case 119:return"u64";case 118:return"f32";case 117:return"f64";case 116:return"char";case 115:return"string";default:throw new Error(`unknown primitive val type. ${e}`)}}function q(e,n){switch(e){case 0:switch(n){case 16:return"coretype";case 17:return"coremodule";default:throw new Error(`unknown outer alias kind 2. ${n}`)}case 3:return"type";case 4:return"component";default:throw new Error(`unknown outer alias kind. ${e}`)}}const K=32,X=0|Math.ceil(K/7);function ee(e,n){const t=[],r=F(n);for(let e=0;e<r;e++){const e={tag:"ComponentExport",name:Q(n),kind:D(n),index:F(n),ty:0===F(n)?void 0:P(n)};t.push(e)}return t}async function ne(e,n,t){const r={tag:"CoreModule"};if(e.compileStreaming){const o=new Promise((o=>{const s=function(e,n,t){let r=n;const o=async n=>{const o=await e.readAvailable(r);if(null===o)t(void 0),n.close();else{const e=o.slice();n.enqueue(e),r-=o.length,0===r&&(t(void 0),n.close())}},s=new ReadableStream({type:"bytes",pull:o}),a=new Headers;a.append("Content-Type","application/wasm"),a.append("Content-Length",""+n);const c=new Response(s,{headers:a,status:200,statusText:"OK"});return c}(n,t,o),a=e.compileStreaming(s);r.module=a}));await o}else{const e=await n.readExact(t);r.data=e}return[r]}function te(e,n,t){const r=F(e);switch(r){case 0:return{tag:"ComponentAliasInstanceExport",kind:$(n,t),instance_index:F(e),name:S(e)};case 1:return{tag:"ComponentAliasCoreInstanceExport",kind:B(t),instance_index:F(e),name:S(e)};case 2:return{tag:"ComponentAliasOuter",kind:q(n,t),count:F(e),index:F(e)};default:throw new Error(`unknown target type. ${r}`)}}const re=[0,97,115,109],oe=[13,0],se=[1,0];async function ae(e,n){let t=e;"string"==typeof e&&(t=function(e){const n=e.startsWith("file://"),t=e.startsWith("https://")||e.startsWith("http://");if(s&&(n||!t))return import("fs/promises").then((n=>n.readFile(e)));if("function"!=typeof globalThis.fetch)throw new Error("globalThis.fetch is not a function");return globalThis.fetch(e)}(e)),t=await a(t);const r="getReader"in(o=t)?new c(o):new i(o);var o;const u=await async function(e,n){try{await ce(e);const t={otherSectionData:n?.otherSectionData??!1,compileStreaming:n?.compileStreaming??WebAssembly.compileStreaming,processCustomSection:n?.processCustomSection??void 0},r=[];for(;;){const n=await ie(t,e);if(null===n)break;for(const e of n)r.push(e)}return r}finally{e.close()}}(r,n);return u}async function ce(e){const n=await e.readExact(re.length),t=await e.readExact(oe.length),r=await e.readExact(se.length);if(!(n.every(((e,n)=>e===re[n]))&&t.every(((e,n)=>e===oe[n]))&&r.every(((e,n)=>e===se[n]))))throw new Error("unexpected magic, version or layer.")}async function ie(e,n){const t=await n.read(!0);if(null===t)return null;const r=await v(n),o=n.pos,s=1==t||4==t?n.subSource(r):void 0,a=1!=t&&4!=t?await n.subSyncSource(r):void 0,c=await(()=>{switch(t){case 0:return function(e,n,t){const r=n.pos,o=S(n),s=n.pos-r,a=n.readExact(t-s);let c={tag:"CustomSection",name:o,data:e.otherSectionData?a:void 0};return e.processCustomSection&&(c=e.processCustomSection(c)),[c]}(e,a,r);case 1:return ne(e,s,r);case 2:return function(e,n){const t=[],r=F(n);for(let e=0;e<r;e++){const e=N(n);t.push(e)}return t}(0,a);case 4:return async function(e,n,t){const r=n.pos+t;await ce(n);let o=[];for(;n.pos!=r;){const t=await ie(e,n);if(null===t)break;o=[...o,...t]}return[{tag:"ComponentSection",sections:o}]}(e,s,r);case 5:return function(e,n){const t=[],r=F(n);for(let e=0;e<r;e++){const e=(()=>{const e=F(n);switch(e){case 0:return{tag:"ComponentInstanceInstantiate",component_index:F(n),args:M(n)};case 1:return{tag:"ComponentInstanceFromExports",exports:ee(0,n)};default:throw new Error(`Unrecognized type in parseSectionInstance: ${e}`)}})();t.push(e)}return t}(0,a);case 6:return function(e,n){const t=F(n),r=[];for(let e=0;e<t;e++){const e=F(n),t=te(n,e,0===e?F(n):void 0);r.push(t)}return r}(0,a);case 7:return function(e,n){const t=[],r=F(n);for(let e=0;e<r;e++){const e=j(n);t.push(e)}return t}(0,a);case 8:return function(e,n){const t=[],r=F(n);for(let e=0;e<r;e++){const e=L(n);t.push(e)}return t}(0,a);case 10:return function(e,n){const t=[],r=F(n);for(let e=0;e<r;e++){const e={tag:"ComponentImport",name:Q(n),ty:P(n)};t.push(e)}return t}(0,a);case 11:return ee(0,a);case 3:case 9:return function(e,n,t,r){const o=n.readExact(r);return[{tag:"SkippedSection",type:t,data:e.otherSectionData?o:void 0}]}(e,a,t,r);default:throw new Error(`unknown section: ${t}`)}})();if(a&&0!==a.remaining){const e=o+a.pos,n=o+r,s=a.remaining,i=function(e){return e.reduce(((e,n)=>e+" "+n.toString(16).padStart(2,"0")),"")}(a.readExact(s));throw new Error(`invalid size after reading section ${t}: \nactual position: 0x${e.toString(16)} vs. expected position 0x${n.toString(16)}, remaining ${s}\nsection: ${JSON.stringify(c)}\nremaining: `+i)}return c}const ue=new Map;function le(e,n){let t=ue.get(e);return void 0!==t||(t=n(),ue.set(e,t)),t}function me(e,n){return le(n,(()=>{if("ComponentValTypePrimitive"===n.tag){if("string"===n.value)return function(e){const n=(e,...n)=>{const t=n[0],r=n[1],o=e.getView(t,r);return e.utf8Decoder.decode(o)};return n.spill=2,n}();throw new Error("Not implemented")}throw new Error("Not implemented")}))}function pe(e,t){return le(t,(()=>{switch(t.tag){case"ComponentValTypePrimitive":switch(t.value){case"string":return(e,n)=>{let t=n;if("string"!=typeof t)throw new TypeError("expected a string");if(0===t.length)return[0,0];let r=0,o=0,s=0;for(;t.length>0;){o=e.realloc(o,r,1,r+t.length),r+=t.length;const{read:n,written:a}=e.utf8Encoder.encodeInto(t,e.getViewU8(o+s,r-s));s+=a,t=t.slice(n)}return r>s&&(o=e.realloc(o,r,1,s)),[o,s]};case"u32":return(e,n)=>[n>>>0];case"s64":return e.usesNumberForInt64?(e,n)=>{const t=n;return[Number(BigInt.asIntN(52,t))]}:(e,n)=>{const t=n;return[BigInt.asIntN(52,t)]};default:throw new Error("Not implemented")}case"ComponentAliasInstanceExport":{const n=e.indexes.componentInstances[t.instance_index];return pe(e,n)}case"ComponentTypeInstance":{const n=t.declarations[0];return pe(e,n)}case"InstanceTypeDeclarationType":{const r=t.value;return n("ComponentTypeDefinedRecord"===r.tag,(()=>`expected ComponentTypeDefinedRecord, got ${r.tag}`)),function(e,n){const t=[];for(const r of n.members){const n=pe(e,r.type);t.push({name:r.name,lifter:n})}return(e,n)=>{let r=[];for(const{name:o,lifter:s}of t){const t=s(e,n[o]);r=[...r,...t]}return r}}(e,r)}case"ComponentValTypeType":{const n=e.indexes.componentTypes[t.value];return pe(e,n)}default:throw new Error("Not implemented "+t.tag)}}))}const de=(e,n)=>{const t=n.element;switch(t.tag){case"CoreInstanceFromExports":return fe(e,n);case"CoreInstanceInstantiate":return ge(e,n);default:throw new Error(`"${t.tag}" not implemented`)}},fe=(e,t)=>{const s=t.element;n(s&&"CoreInstanceFromExports"==s.tag,(()=>`Wrong element type '${s?.tag}'`));const a=[];for(const n of s.exports)switch(n.kind){case"func":{const t=e.indexes.coreFunctions[n.index],r=he(e,{element:t,callerElement:n});a.push(r);break}case"table":{const t=e.indexes.coreTables[n.index],r=he(e,{element:t,callerElement:n});a.push(r);break}default:throw new Error(`"${n.kind}" not implemented`)}return{element:s,callerElement:t.callerElement,binder:async(e,n)=>{const s={};for(const c of a){const a=c.callerElement,i={arguments:n.arguments,callerArgs:n};o(n,i,t.element.tag+":"+t.element.selfSortIndex),o(i,i,a.kind+":"+a.name);const u=await c.binder(e,i);s[a.name]=u.result,r&&(s["arguments-of:"+a.name]=n)}const c={result:s};return r&&(c.arguments=n),c}}},ge=(e,t)=>{const s=t.element;n(s&&"CoreInstanceInstantiate"==s.tag,(()=>`Wrong element type '${s?.tag}'`));const a=s.module_index,c=((e,t)=>{const o=t.element;n(o&&"CoreModule"==o.tag,(()=>`Wrong element type '${o?.tag}'`));const s=t.callerElement.selfSortIndex;return{callerElement:t.callerElement,element:o,binder:async(n,t)=>{let a=n.coreInstances[s];if(a)return a;const c=await o.module,i=await e.wasmInstantiate(c,t.arguments),u=i.exports;a={result:i},n.coreInstances[s]=a;const l=u.memory;l&&n.initializeMemory(l);const m=u.cabi_realloc;return m&&n.initializeRealloc(m),r&&(a.bargs=t),r&&(a.coreInstanceIndex=s),r&&(a.coreModuleIndex=o.selfSortIndex),a}}})(e,{element:e.indexes.coreModules[a],callerElement:s}),i=[];for(const n of s.args)switch(n.kind){case"instance":{const t=e.indexes.coreInstances[n.index],r=de(e,{callerElement:n,element:t});i.push(r);break}default:throw new Error(`"${n.kind}" not implemented`)}return{element:s,callerElement:t.callerElement,binder:async(e,n)=>{const s={debugSource:t.element.tag};for(const r of i){const a=r.callerElement,c={arguments:n.arguments,callerArgs:n};o(n,c,t.element.tag+":"+t.element.selfSortIndex),o(c,c,a.index+":"+a.name);const i=await r.binder(e,c);s[r.callerElement.name]=i.result}const a={arguments:s,callerArgs:n,aaa:1};o(n,a,t.element.tag+":"+t.element.selfSortIndex);const u=await c.binder(e,a),l={result:u.result};return r&&(l.bargs=n),r&&(l.moduleResult=u),l}}},he=(e,n)=>{const t=n.element;switch(t.tag){case"ComponentAliasCoreInstanceExport":return((e,n)=>{const t=n.element,s=t.instance_index,a=e.indexes.coreInstances[s],c=de(e,{element:a,callerElement:t});return{callerElement:n.callerElement,element:t,binder:async(e,a)=>{const i={arguments:{missingArgEx:n.element.tag},callerArgs:a};o(a,i,n.element.tag+":"+n.element.selfSortIndex);const u=await c.binder(e,i),l={result:u.result.exports[t.name]};return r&&(l.bargs=a),r&&(l.moduleResult=u),r&&(l.fromExportName=t.name),r&&(l.fromCoreInstanceIndex=s),l}}})(e,n);case"CanonicalFunctionLower":return we(e,n);default:throw new Error(`"${t.tag}" not implemented`)}},we=(e,t)=>{const s=t.element;n(s&&"CanonicalFunctionLower"==s.tag,(()=>`Wrong element type '${s?.tag}'`));const a=e.indexes.componentFunctions[s.func_index],c=ye(e,{element:a,callerElement:s}),i=function(e,n){return le(n,(()=>(t,r)=>{const o=[];for(const e of n.params){const n=me(0,e.type);o.push(n)}const s=[];switch(n.results.tag){case"ComponentFuncResultNamed":for(const t of n.results.values){const n=pe(e,t.type);s.push(n)}break;case"ComponentFuncResultUnnamed":{const t=pe(e,n.results.type);s.push(t)}}return function(...e){let n=[];for(let r=0;r<o.length;){const s=o[r],a=s.spill,c=e.slice(r,r+a),i=s(t,...c);r+=a,n=[...n,i]}const a=r(...n);1===s.length&&s[0](a)}}))}(e,e.indexes.componentInstances[0].declarations[2].value);return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const s={arguments:n.arguments,callerArgs:n};o(n,s,t.element.tag+":"+t.element.selfSortIndex),o(s,s,a.tag+":"+a.selfSortIndex);const u=await c.binder(e,s),l={result:i(e,u.result)};return r&&(l.bargs=n),l}}},ye=(e,n)=>{const t=n.element;switch(t.tag){case"CanonicalFunctionLift":return Ae(e,n);case"ComponentAliasInstanceExport":return Ee(e,n);default:throw new Error(`"${t.tag}" not implemented`)}},Ae=(e,t)=>{const s=t.element;n(s&&"CanonicalFunctionLift"==s.tag,(()=>`Wrong element type '${s?.tag}'`));const a=e.indexes.coreFunctions[s.core_func_index],c=he(e,{element:a,callerElement:s}),i=e.indexes.componentTypes[s.type_index];n("ComponentTypeFunc"===i.tag,(()=>`expected ComponentTypeFunc, got ${i.tag}`));const u=function(e,n){return le(n,(()=>{const t=[];for(const r of n.params){const n=pe(e,r.type);t.push(n)}const r=[];switch(n.results.tag){case"ComponentFuncResultNamed":for(const e of n.results.values){const n=me(0,e.type);r.push(n)}break;case"ComponentFuncResultUnnamed":{const e=me(0,n.results.type);r.push(e)}}return(e,n)=>function(...o){let s=[];for(let n=0;n<t.length;n++){const r=t[n],a=o[n],c=r(e,a);s=[...s,...c]}const a=n(...s);1===r.length&&r[0](a)}}))}(e,i);return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const s={arguments:n.arguments,callerArgs:n};o(n,s,t.element.tag+":"+t.element.selfSortIndex);const a=await c.binder(e,s),i={result:u(e,a.result)};return r&&(i.bargs=n),i}}},Ee=(e,t)=>{const s=t.element;if(n(s&&"ComponentAliasInstanceExport"==s.tag,(()=>`Wrong element type '${s?.tag}'`)),"type"===s.kind)return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const o={missingRes:t.element.tag,confused:1,result:{missingResTypes:t.element.tag}};return r&&(o.bargs=n),o}};if("func"!==s.kind)throw new Error(`"${s.kind}" not implemented`);return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{o(n,{arguments:n.arguments,callerArgs:n},t.element.tag+":"+t.element.selfSortIndex);const s=n.arguments["import-func-run"]??n.arguments["hello:city/city"].sendMessage,a={missingRes:t.element.tag,confused:3,result:s};return r&&(a.bargs=n),a}}},xe=(e,n)=>{const t=n.element;if(!t)throw new Error("Wrong element type ");switch(t.tag){case"ComponentSection":return be(e,n);case"ComponentAliasInstanceExport":return Ee(e,n);default:throw new Error(`"${t.tag}" not implemented`)}},be=(e,t)=>{const s=t.element;n(s&&"ComponentSection"==s.tag,(()=>`Wrong element type '${s?.tag}'`));const a=[];for(const n of s.sections)switch(n.tag){case"ComponentExport":{const t=Fe(e,{element:n,callerElement:n});a.push(t);break}case"ComponentImport":case"ComponentTypeFunc":case"ComponentTypeDefinedRecord":case"ComponentTypeDefinedTuple":case"ComponentTypeDefinedEnum":case"ComponentTypeDefinedVariant":break;default:throw new Error(`${n.tag} not implemented`)}return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const s={};for(const r of a){const a=r.callerElement,c={arguments:n.arguments,callerArgs:n,debugSource:a.tag+":"+a.name.name};o(n,c,t.element.tag+":"+t.element.selfSortIndex),o(c,c,a.tag+":"+a.name.name);const i=await r.binder(e,c);s[a.name.name]=i.result}const c={result:{...s}};return r&&(c.arguments=n),c}}},Ce=(e,n)=>{const t=n.element;switch(t.tag){case"ComponentInstanceInstantiate":return Ie(e,n);case"ComponentInstanceFromExports":return Te(e,n);case"ComponentTypeInstance":return ve(e,n);default:throw new Error(`"${t.tag}" not implemented`)}},Ie=(e,t)=>{const s=t.element;n(s&&"ComponentInstanceInstantiate"==s.tag,(()=>`Wrong element type '${s?.tag}'`));const a=s.component_index,c=e.indexes.componentTypes[a],i=xe(e,{element:c,callerElement:s}),u=[];for(const n of s.args)switch(n.kind){case"func":{const t=e.indexes.componentFunctions[n.index],r=ye(e,{element:t,callerElement:n});u.push(r);break}case"instance":{const t=e.indexes.componentInstances[n.index],r=Ce(e,{element:t,callerElement:n});u.push(r);break}case"type":break;default:throw new Error(`"${n.kind}" not implemented`)}return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const s={};for(const a of u){const c=a.callerElement,i={arguments:n.arguments,callerArgs:n};o(n,i,t.element.tag+":"+t.element.selfSortIndex),o(i,i,"ComponentInstantiationArg:"+c.index+":"+c.name);const u=await a.binder(e,i);s[c.name]=u.result,r&&(s["arguments-of:"+c.name]=n)}const a={arguments:s,callerArgs:n};o(n,a,t.element.tag+":"+t.element.selfSortIndex);const c={result:(await i.binder(e,a)).result};return r&&(c.bargs=n),c}}},Te=(e,t)=>{const r=t.element;throw n(r&&"ComponentInstanceFromExports"==r.tag,(()=>`Wrong element type '${r?.tag}'`)),new Error("TODO")},ve=(e,t)=>{const o=t.element;n(o&&"ComponentTypeInstance"==o.tag,(()=>`Wrong element type '${o?.tag}'`));for(const e of o.declarations)switch(e.tag){case"InstanceTypeDeclarationType":break;case"InstanceTypeDeclarationExport":switch(e.ty.tag){case"ComponentTypeRefType":case"ComponentTypeRefFunc":break;default:throw new Error(`"${e.ty.tag}" not implemented`)}break;default:throw new Error(`"${e.tag}" not implemented`)}return{callerElement:t.callerElement,element:o,binder:async(e,n)=>{const o={missingRes:t.element.tag,result:{missingResRes:t.element.tag,confused:2}};return r&&(o.bargs=n),o}}},Fe=(e,t)=>{const s=t.element;switch(n(s&&"ComponentExport"==s.tag,(()=>`Wrong element type '${s?.tag}'`)),s.kind){case"func":{const n=e.indexes.componentFunctions[s.index],a=ye(e,{element:n,callerElement:s});return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const s={arguments:n.arguments,callerArgs:n};o(n,s,t.element.tag+":"+t.element.name.name+":"+t.element.kind);const c=await a.binder(e,s),i={result:c.result};return r&&(i.bargs=n),r&&(i.exportResult=c),i}}}case"instance":{const n=e.indexes.componentInstances[s.index],a=Ce(e,{element:n,callerElement:s});return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const c={arguments:n.arguments,callerArgs:n};o(n,c,t.element.tag+":"+t.element.name.name+":"+t.element.kind);const i=await a.binder(e,c),u={};u[s.name.name]=i.result;const l={result:u};return r&&(l.bargs=n),r&&(l.exportResult=i),l}}}case"type":{const n=e.indexes.componentTypes[s.index],a=xe(e,{element:n,callerElement:s});return{callerElement:t.callerElement,element:s,binder:async(e,n)=>{const c={arguments:n.arguments,callerArgs:n};o(n,c,t.element.tag+":"+t.element.name.name+":"+t.element.kind);const i=await a.binder(e,c),u={};u[s.name.name]=i.result;const l={result:u};return r&&(l.bargs=n),r&&(l.exportResult=i),l}}}default:throw new Error(`${s.kind} not implemented`)}};function ke(e,n,t,r){switch(n){case"CoreModule":return e.indexes.coreModules;case"ComponentExport":return e.indexes.componentExports;case"ComponentImport":return e.indexes.componentImports;case"ComponentAliasCoreInstanceExport":switch(r){case"func":return e.indexes.coreFunctions;case"table":return e.indexes.coreTables;case"memory":return e.indexes.coreMemories;case"global":return e.indexes.coreGlobals;default:throw new Error(`unexpected section tag: ${r}`)}break;case"ComponentAliasInstanceExport":switch(r){case"func":return e.indexes.componentFunctions;case"component":case"type":return e.indexes.componentTypes;default:throw new Error(`unexpected section tag: ${r}`)}case"CoreInstanceFromExports":case"CoreInstanceInstantiate":return e.indexes.coreInstances;case"ComponentInstanceFromExports":case"ComponentInstanceInstantiate":return e.indexes.componentInstances;case"ComponentTypeFunc":return e.indexes.componentTypes;case"ComponentSection":return t?e.indexes.componentTypes:e.indexes.componentSections;case"ComponentTypeDefinedBorrow":case"ComponentTypeDefinedEnum":case"ComponentTypeDefinedFlags":case"ComponentTypeDefinedList":case"ComponentTypeDefinedOption":case"ComponentTypeDefinedOwn":case"ComponentTypeDefinedPrimitive":case"ComponentTypeDefinedRecord":case"ComponentTypeDefinedResult":case"ComponentTypeDefinedTuple":case"ComponentTypeDefinedVariant":return e.indexes.componentTypes;case"ComponentTypeInstance":return e.indexes.componentInstances;case"ComponentTypeResource":return e.indexes.componentTypeResource;case"CanonicalFunctionLower":return e.indexes.coreFunctions;case"CanonicalFunctionLift":return e.indexes.componentFunctions;case"SkippedSection":case"CustomSection":return[];default:throw new Error(`unexpected section tag: ${n}`)}}async function Se(e,n,t){let r=e;("object"!=typeof r||Array.isArray(r)&&0!=r.length&&"object"!=typeof r[0])&&(r=await ae(r,t??{}));return(await Be(r,t)).instantiate(n)}async function Be(e,n){let o=e;("object"!=typeof o||Array.isArray(o)&&0!=o.length&&"object"!=typeof o[0])&&(o=await ae(o,n??{}));const s=function(e,n){const t={usesNumberForInt64:!0===n.useNumberForInt64,wasmInstantiate:n.wasmInstantiate??WebAssembly.instantiate,indexes:{componentExports:[],componentImports:[],componentFunctions:[],componentInstances:[],componentTypes:[],componentTypeResource:[],coreModules:[],coreInstances:[],coreFunctions:[],coreMemories:[],coreTables:[],coreGlobals:[],componentSections:[]}},r=t.indexes;for(const n of e)ke(t,n.tag,!1,n.kind).push(n);return t.indexes.componentTypes=[...t.indexes.componentSections,...r.componentTypes],function(e){function n(e){for(let n=0;n<e.length;n++)e[n].selfSortIndex=n}n(e.indexes.componentExports),n(e.indexes.componentImports),n(e.indexes.componentFunctions),n(e.indexes.componentInstances),n(e.indexes.componentTypes),n(e.indexes.componentTypeResource),n(e.indexes.coreModules),n(e.indexes.coreInstances),n(e.indexes.coreFunctions),n(e.indexes.coreMemories),n(e.indexes.coreTables),n(e.indexes.coreGlobals)}(t),t}(o,n??{});for(const e of s.indexes.coreModules)await e.module;const a=[];for(const e of s.indexes.coreInstances){const n=de(s,{element:e,callerElement:void 0});a.push(n)}const c=[];for(const e of s.indexes.componentExports){const n=Fe(s,{element:e,callerElement:void 0});c.push(n)}return{resolverContext:s,instantiate:async function(e){const n=function(e,n){let r,o;function s(e,n){return new DataView(r.buffer,e,n)}const a={componentImports:n,coreInstances:[],componentInstances:[],utf8Decoder:new TextDecoder,utf8Encoder:new TextEncoder,initializeMemory:function(e){r=e},initializeRealloc:function(e){o=e},getView:s,getViewU8:function(e,n){return new Uint8Array(r.buffer,e,n)},getMemory:function(){return r},realloc:function(e,n,t,r){return o(e,n,t,r)},alloc:function(e,n){return o(0,0,n,e)},readI32:function(e){return s().getInt32(e)},writeI32:function(e,n){return s().setInt32(e,n)},abort:function(){throw new Error("not implemented")}};return"Debug"===t&&(a.debugStack=[]),a}(0,e=e??{}),o={};for(const t of c){const s={arguments:e};r&&(s.debugStack=[]);const a=await t.binder(n,s);Object.assign(o,a.result)}for(const t of a){const o={arguments:e};r&&(o.debugStack=[]),await t.binder(n,o)}return{exports:o,abort:n.abort}}}}function De(){return{gitHash:"8a28011f7c1c6ac4ede9aff1d9f3a68994db614e",configuration:e}}var $e;t=$e=e,r="Debug"===$e;export{Be as createComponent,pe as createLifting,me as createLowering,De as getBuildInfo,Se as instantiateComponent,ae as parse};
//# sourceMappingURL=index.js.map
